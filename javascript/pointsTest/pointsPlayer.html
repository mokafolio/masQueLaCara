<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>point player</title>
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="frameData.json"></script>
    <script type="text/javascript" src="vendor/paper-full.js"></script>



    <script type="text/paperscript" canvas="canvas">
        
        var dataObject = JSON.parse(data);
        //console.log(dataObject.length);
        //console.log(dataObject);
        var frameData;
        var frame = 0;

        var leftEye = new Point(0, 0);
        var rightEye = new Point(0, 0);
        var mouth = new Point(0, 0);
        var nose = new Point(0, 0);
        
        var leftEyeAngle;



        var values = {
            count: 68
        };

        // ------------------------------------------------------------- make circles: 
        var layer = project.activeLayer;
        for (var i = 0; i < values.count; i++) {
            var path = new Path.Circle(new Point(100, 100), 5);
            project.activeLayer.children[i].fillColor = 'red';
            console.log(project.activeLayer.children[i]);
        }
        console.log(project.activeLayer.children.length);

        // ------------------------------------------------------------- make typography in another layer (so we an see points) 
        var typeLayer = new Layer();
        for (var i = 0; i < values.count; i++) {
            var text = new PointText({
                    point: view.center,
                    justification: 'center',
                    fontSize: 10,
                    fillColor: 'blue'
            });
            text.content = i;
        }
        // ------------------------------------------------------------- mouth eyes nose
        var faceParts = new Layer();
        for (var i = 0; i < 4; i++) {
            if (i != 0){
                var path = new Path.Circle(new Point(100, 100), 20);
            } else {
                var path = new Path.Rectangle(new Point(50, 50), new Size(100, 50));

                // Create a group from the two paths:
                var group = new Group({
                    children: [path],
                    // Set the stroke color of all items in the group:
                    strokeColor: 'black',
                    // Move the group to the center of the view:
                    position: view.center, 
                    transformContent: false
                });

            }
            project.activeLayer.children[i].fillColor = new Color(0,255,0,0.3);
        }


        function onFrame(event) {
            
            frame++;
            frameData = dataObject[frame % dataObject.length];
            //console.log(frameData);
            for (var i = 0; i < values.count; i++) {
                
               var item = layer.children[i];
               // console.log();
               item.position.x =  frameData[i][0] * 2.0;
               item.position.y =  frameData[i][1] * 2.0;

               item = typeLayer.children[i];
               item.position.x =  frameData[i][0] * 2.0;
               item.position.y =  frameData[i][1] * 2.0 + 10;


                //var angle = (values.count - i) * Math.sin(event.count / 128) / 10;
                //item.rotate(angle);
            }

            // calculate the right eye, left eye, etc: 
            leftEye.x = leftEye.y = 0;
            for (var i = 36; i <= 41; i++){
                leftEye += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            leftEye /= 6.0;

            var diff = new Point(frameData[39][0] - frameData[36][0], frameData[39][1] - frameData[36][1]);
            var leftEyeAngle = Math.atan2(diff.y, diff.x);


            rightEye.x = rightEye.y = 0;
            for (var i = 42; i <= 47; i++){
                rightEye += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            rightEye /= 6.0;

            nose.x = nose.y = 0;
            for (var i = 29; i <= 35; i++){
                nose += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            nose /= 7.0;

            mouth.x = mouth.y = 0;
            for (var i = 48; i <= 59; i++){
                mouth += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            mouth /= 12.0;

            //console.log(mouth);

            faceParts.children[0].position = leftEye;
            faceParts.children[0].rotation = leftEyeAngle * (180.0 / Math.PI);
            faceParts.children[1].position = rightEye;
            faceParts.children[2].position = nose;
            faceParts.children[3].position = mouth;


                
        }

        // Reposition the paths whenever the window is resized:
        function onResize(event) {
            layer.position = view.center;
        }
    </script>
</head>
<body>
    <canvas id="canvas" resize ></canvas>
</body>
</html>
