<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>point player</title>
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="frameData.json"></script>
    <script type="text/javascript" src="vendor/paper-full.js"></script>


    <script type="text/paperscript" canvas="canvas">
        
        var dataObject = JSON.parse(data);
        //console.log(dataObject.length);
        //console.log(dataObject);
        var frameData;
        var frame = 0;

        var leftEye = new Point(0, 0);
        var rightEye = new Point(0, 0);
        var mouth = new Point(0, 0);
        var nose = new Point(0, 0);
        
        var leftEyeAngle;

        var values = {
            count: 68
        };

        // ------------------------------------------------------------- make circles: 
        var layer = project.activeLayer;
        for (var i = 0; i < values.count; i++) {
            var path = new Path.Circle(new Point(100, 100), 5);
            project.activeLayer.children[i].fillColor = 'red';
            console.log(project.activeLayer.children[i]);
        }
        console.log(project.activeLayer.children.length);

        // ------------------------------------------------------------- make typography in another layer (so we an see points) 
        var typeLayer = new Layer();
        for (var i = 0; i < values.count; i++) {
            var text = new PointText({
                    point: view.center,
                    justification: 'center',
                    fontSize: 10,
                    fillColor: 'blue'
            });
            text.content = i;
        }
        // ------------------------------------------------------------- mouth eyes nose
        var faceParts = new Layer();
        for (var i = 0; i < 4; i++) {
            if (i != 0){
                var path = new Path.Circle(new Point(100, 100), 20);
            } else {
                var path = new Path.Rectangle(new Point(50, 50), new Size(100, 50));

                // Create a group from the two paths:
                var group = new Group({
                    children: [path],
                    // Set the stroke color of all items in the group:
                    strokeColor: 'black',
                    // Move the group to the center of the view:
                    position: view.center, 
                    transformContent: false
                });

            }
            project.activeLayer.children[i].fillColor = new Color(0,255,0,0.3);
        }

        var artworkLayer = new Layer();
        var svgEye = project.importSVG(document.getElementById('eye'));

        //console.log(svgEye);
        //

        function onFrame(event) {
            
            frame++;
            frameData = dataObject[frame % dataObject.length];
            //console.log(frameData);
            for (var i = 0; i < values.count; i++) {
                
               var item = layer.children[i];
               // console.log();
               item.position.x =  frameData[i][0] * 2.0;
               item.position.y =  frameData[i][1] * 2.0;

               item = typeLayer.children[i];
               item.position.x =  frameData[i][0] * 2.0;
               item.position.y =  frameData[i][1] * 2.0 + 10;


                //var angle = (values.count - i) * Math.sin(event.count / 128) / 10;
                //item.rotate(angle);
            }

            // calculate the right eye, left eye, etc: 
            leftEye.x = leftEye.y = 0;
            for (var i = 36; i <= 41; i++){
                leftEye += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            leftEye /= 6.0;

            var diff = new Point(frameData[39][0] - frameData[36][0], frameData[39][1] - frameData[36][1]);
            var leftEyeAngle = Math.atan2(diff.y, diff.x);


            rightEye.x = rightEye.y = 0;
            for (var i = 42; i <= 47; i++){
                rightEye += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            rightEye /= 6.0;

            nose.x = nose.y = 0;
            for (var i = 29; i <= 35; i++){
                nose += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            nose /= 7.0;

            mouth.x = mouth.y = 0;
            for (var i = 48; i <= 59; i++){
                mouth += new Point(frameData[i][0], frameData[i][1]) * 2.0;
            }
            mouth /= 12.0;

            //console.log(mouth);

            faceParts.children[0].position = leftEye;
            faceParts.children[0].rotation = leftEyeAngle * (180.0 / Math.PI);
            faceParts.children[1].position = rightEye;
            faceParts.children[2].position = nose;
            faceParts.children[3].position = mouth;

            
            svgEye.position= leftEye;
        }

        // Reposition the paths whenever the window is resized:
        function onResize(event) {
            layer.position = view.center;
        }
    </script>
</head>
<body>

    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="86.331px" height="136.412px"
      visibility="hidden" >
    <g id="eye">
    <path style="fill:#FFFFFF;" d="M43.165,43.302c-10.245,0-19.184,5.57-23.971,13.841c4.787,8.273,13.726,13.841,23.971,13.841
        c10.244,0,19.183-5.568,23.971-13.841C62.348,48.872,53.409,43.302,43.165,43.302z M43.165,67.367
        c-5.647,0-10.225-4.577-10.225-10.224c0-5.646,4.577-10.224,10.225-10.224c5.646,0,10.224,4.577,10.224,10.224
        C53.389,62.79,48.812,67.367,43.165,67.367z"/>
    <circle style="fill:#FFFFFF;" cx="43.165" cy="57.143" r="4.513"/>
    <circle style="fill:#FFFFFF;" cx="14.682" cy="57.143" r="4.513"/>
    <circle style="fill:#FFFFFF;" cx="71.648" cy="56.842" r="4.513"/>
    <circle style="fill:#FFFFFF;" cx="43.165" cy="4.512" r="4.513"/>
    <path style="fill:#FFFFFF;" d="M43.163,29.973c3.377,0,6.316,1.837,7.896,4.562c0.778-1.344,1.23-2.899,1.23-4.563
        c0-5.038-4.085-9.123-9.126-9.123c-5.039,0-9.123,4.085-9.123,9.123c0,1.664,0.452,3.219,1.23,4.563
        C36.849,31.81,39.788,29.973,43.163,29.973z"/>
    <path style="fill:#FFFFFF;" d="M43.173,93.249c-15.976,0-29.882-8.695-37.353-21.584C2.139,78.021,0,85.381,0,93.253
        c0,23.835,19.324,43.159,43.173,43.159c23.838,0,43.158-19.324,43.158-43.159c0-7.872-2.139-15.231-5.82-21.588
        C73.045,84.554,59.139,93.249,43.173,93.249z"/>
    <path style="fill:#FFFFFF;" d="M43.166,13.587c-3.377,0-6.316-1.838-7.896-4.562c-0.778,1.344-1.23,2.899-1.23,4.563
        c0,5.038,4.085,9.123,9.126,9.123c5.039,0,9.123-4.085,9.123-9.123c0-1.664-0.452-3.22-1.23-4.563
        C49.48,11.75,46.541,13.587,43.166,13.587z"/>
    </g>
    </svg>

    <canvas id="canvas" resize ></canvas>
</body>
</html>
